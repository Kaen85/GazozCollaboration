<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basit Kule Savunma Oyunu</title>
    <style>
        body {
            background-color: #222;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        h1 { margin-bottom: 10px; }
        #game-container {
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        canvas {
            background-color: #4CAF50; /* Ã‡im rengi */
            border: 4px solid #333;
            cursor: crosshair;
            display: block;
        }
        #ui-layer {
            margin-top: 10px;
            display: flex;
            gap: 20px;
            font-size: 1.2rem;
            background: #333;
            padding: 10px 20px;
            border-radius: 8px;
        }
        .stat { font-weight: bold; }
        #gold { color: #FFD700; }
        #lives { color: #FF4444; }
        #wave { color: #44AAFF; }
        
        /* Oyun Bitti EkranÄ± */
        #game-over {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 40px;
            text-align: center;
            border-radius: 10px;
            border: 2px solid white;
        }
        button {
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            background: #44AAFF;
            border: none;
            color: white;
            border-radius: 5px;
            margin-top: 10px;
        }
        button:hover { background: #2288DD; }
    </style>
</head>
<body>

    <h1>ğŸ° Kule Savunma</h1>
    
    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="game-over">
            <h2>OYUN BÄ°TTÄ°!</h2>
            <p>PuanÄ±n: <span id="final-score">0</span></p>
            <button onclick="startGame()">Tekrar Oyna</button>
        </div>
    </div>

    <div id="ui-layer">
        <span class="stat">ğŸ’° AltÄ±n: <span id="gold">100</span></span>
        <span class="stat">â¤ï¸ Can: <span id="lives">20</span></span>
        <span class="stat">ğŸŒŠ Dalga: <span id="wave">1</span></span>
        <span class="stat" style="font-size: 0.9rem; margin-left: 20px;">(Kule: 50 AltÄ±n)</span>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Oyun AyarlarÄ±
    const FPS = 60;
    const TILE_SIZE = 40;
    const TOWER_COST = 50;
    
    // Oyun Durumu DeÄŸiÅŸkenleri
    let gameLoop;
    let gold = 100;
    let lives = 20;
    let wave = 1;
    let frameCount = 0;
    let enemies = [];
    let towers = [];
    let projectiles = [];
    let gameOver = false;

    // Harita Yolu (Koordinatlar)
    // Basit bir "S" Ã§izer gibi yol noktalarÄ±
    const path = [
        {x: 0, y: 100},
        {x: 700, y: 100},
        {x: 700, y: 300},
        {x: 100, y: 300},
        {x: 100, y: 500},
        {x: 800, y: 500}
    ];

    class Enemy {
        constructor() {
            this.pathIndex = 0;
            this.x = path[0].x;
            this.y = path[0].y;
            this.radius = 15;
            this.speed = 2 + (wave * 0.2); // Her dalgada hÄ±zlanÄ±r
            this.health = 30 + (wave * 10); // Her dalgada canÄ± artar
            this.maxHealth = this.health;
            this.completed = false;
        }

        update() {
            // Hedef noktaya git
            let target = path[this.pathIndex + 1];
            if (!target) {
                this.completed = true;
                return;
            }

            let dx = target.x - this.x;
            let dy = target.y - this.y;
            let dist = Math.hypot(dx, dy);

            if (dist < this.speed) {
                this.x = target.x;
                this.y = target.y;
                this.pathIndex++;
            } else {
                this.x += (dx / dist) * this.speed;
                this.y += (dy / dist) * this.speed;
            }
        }

        draw() {
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // Can barÄ±
            ctx.fillStyle = 'black';
            ctx.fillRect(this.x - 15, this.y - 25, 30, 5);
            ctx.fillStyle = '#0f0';
            ctx.fillRect(this.x - 15, this.y - 25, 30 * (this.health / this.maxHealth), 5);
        }
    }

    class Tower {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.range = 150;
            this.cooldown = 0;
            this.fireRate = 30; // Kare sayÄ±sÄ± cinsinden (30 kare = 0.5 sn)
        }

        update() {
            if (this.cooldown > 0) this.cooldown--;

            // En yakÄ±ndaki dÃ¼ÅŸmanÄ± bul
            if (this.cooldown <= 0) {
                let target = null;
                let minDist = Infinity;

                for (let enemy of enemies) {
                    let dist = Math.hypot(enemy.x - this.x, enemy.y - this.y);
                    if (dist < this.range && dist < minDist) {
                        minDist = dist;
                        target = enemy;
                    }
                }

                if (target) {
                    projectiles.push(new Projectile(this.x, this.y, target));
                    this.cooldown = this.fireRate;
                }
            }
        }

        draw() {
            // Kule gÃ¶vdesi
            ctx.fillStyle = 'blue';
            ctx.fillRect(this.x - 20, this.y - 20, 40, 40);
            
            // Kule Ã§atÄ±sÄ±
            ctx.fillStyle = '#55a';
            ctx.beginPath();
            ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
            ctx.fill();

            // Menzil dairesi (Sadece mouse Ã¼zerindeyken Ã§izilebilir ama ÅŸimdilik basit kalsÄ±n)
            // ctx.strokeStyle = 'rgba(0,0,0,0.1)';
            // ctx.beginPath();
            // ctx.arc(this.x, this.y, this.range, 0, Math.PI * 2);
            // ctx.stroke();
        }
    }

    class Projectile {
        constructor(x, y, target) {
            this.x = x;
            this.y = y;
            this.target = target;
            this.speed = 10;
            this.damage = 10;
            this.active = true;
        }

        update() {
            let dx = this.target.x - this.x;
            let dy = this.target.y - this.y;
            let dist = Math.hypot(dx, dy);

            if (dist < this.speed) {
                // Hedefe vurdu
                this.target.health -= this.damage;
                this.active = false;
                if (this.target.health <= 0 && !this.target.dead) {
                    this.target.dead = true; // Ã–ldÃ¼ iÅŸaretle
                    gold += 10;
                    updateUI();
                }
            } else {
                this.x += (dx / dist) * this.speed;
                this.y += (dy / dist) * this.speed;
            }
        }

        draw() {
            ctx.fillStyle = 'yellow';
            ctx.beginPath();
            ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function drawPath() {
        ctx.strokeStyle = '#888'; // Yol rengi (Gri)
        ctx.lineWidth = 40;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        
        ctx.beginPath();
        ctx.moveTo(path[0].x, path[0].y);
        for (let i = 1; i < path.length; i++) {
            ctx.lineTo(path[i].x, path[i].y);
        }
        ctx.stroke();
        
        // Yolun ortasÄ±na ince Ã§izgi
        ctx.strokeStyle = '#aaa';
        ctx.lineWidth = 2;
        ctx.stroke();
    }

    function updateUI() {
        document.getElementById('gold').innerText = gold;
        document.getElementById('lives').innerText = lives;
        document.getElementById('wave').innerText = wave;
    }

    function endGame() {
        gameOver = true;
        document.getElementById('game-over').style.display = 'block';
        document.getElementById('final-score').innerText = wave;
    }

    function startGame() {
        gold = 100;
        lives = 20;
        wave = 1;
        enemies = [];
        towers = [];
        projectiles = [];
        gameOver = false;
        document.getElementById('game-over').style.display = 'none';
        updateUI();
        
        if (gameLoop) clearInterval(gameLoop);
        gameLoop = setInterval(gameLoopFn, 1000 / FPS);
    }

    function gameLoopFn() {
        if (gameOver) return;

        // ArkaplanÄ± Temizle
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Yolu Ã‡iz
        drawPath();

        // DÃ¼ÅŸman OluÅŸturma MantÄ±ÄŸÄ±
        frameCount++;
        if (frameCount % (100 - (wave * 2)) === 0) { // Dalga arttÄ±kÃ§a daha sÄ±k gelir
            enemies.push(new Enemy());
        }
        
        // Dalga atlama (Basit zaman bazlÄ±)
        if (frameCount % 1200 === 0) { // Her 20 saniyede bir yeni dalga
            wave++;
            updateUI();
        }

        // Kuleleri GÃ¼ncelle ve Ã‡iz
        towers.forEach(tower => {
            tower.update();
            tower.draw();
        });

        // DÃ¼ÅŸmanlarÄ± GÃ¼ncelle ve Ã‡iz
        for (let i = enemies.length - 1; i >= 0; i--) {
            let enemy = enemies[i];
            enemy.update();
            enemy.draw();

            if (enemy.dead) {
                enemies.splice(i, 1);
            } else if (enemy.completed) {
                lives--;
                enemies.splice(i, 1);
                updateUI();
                if (lives <= 0) endGame();
            }
        }

        // Mermileri GÃ¼ncelle ve Ã‡iz
        for (let i = projectiles.length - 1; i >= 0; i--) {
            let proj = projectiles[i];
            proj.update();
            proj.draw();
            if (!proj.active) projectiles.splice(i, 1);
        }
    }

    // TÄ±klama ile Kule Koyma
    canvas.addEventListener('mousedown', (e) => {
        if (gameOver) return;

        const rect = canvas.getBoundingClientRect();
        const mouseX = e.clientX - rect.left;
        const mouseY = e.clientY - rect.top;

        // Yola Ã§ok yakÄ±n mÄ± kontrolÃ¼ (Basit bir kontrol)
        // GeliÅŸmiÅŸ oyunlarda grid sistemi kullanÄ±lÄ±r
        let onPath = false;
        // BasitÃ§e yol noktalarÄ±na olan uzaklÄ±ÄŸÄ± deÄŸil, gÃ¶rsel olarak kontrol etmek zor
        // Bu yÃ¼zden sadece paraya bakÄ±p koyalÄ±m, ama Ã¼st Ã¼ste koymayÄ± engelleyelim.
        
        // Ãœst Ã¼ste koymayÄ± engelle
        for (let t of towers) {
            if (Math.hypot(t.x - mouseX, t.y - mouseY) < 40) return;
        }

        if (gold >= TOWER_COST) {
            towers.push(new Tower(mouseX, mouseY));
            gold -= TOWER_COST;
            updateUI();
        }
    });

    // Oyunu BaÅŸlat
    startGame();

</script>

</body>
</html>